# إعداد قاعدة البيانات - Supabase

هذا الدليل يوضح كيفية إعداد قاعدة البيانات لتطبيق الألعاب باستخدام Supabase.

## الخطوات المطلوبة

### 1. إنشاء مشروع Supabase

1. اذهب إلى [supabase.com](https://supabase.com)
2. قم بإنشاء حساب جديد أو تسجيل الدخول
3. انقر على "New Project"
4. اختر اسماً للمشروع وكلمة مرور قوية لقاعدة البيانات
5. اختر المنطقة الأقرب إليك
6. انقر على "Create new project"

### 2. الحصول على مفاتيح API

بعد إنشاء المشروع:

1. اذهب إلى Settings > API
2. انسخ القيم التالية:
   - `Project URL`
   - `anon public` key
   - `service_role` key (اختياري)

### 3. تحديث ملف البيئة

قم بتحديث ملف `.env.local` في جذر المشروع:

```env
NEXT_PUBLIC_SUPABASE_URL=your_project_url_here
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

### 4. تشغيل سكريبت قاعدة البيانات

1. اذهب إلى Supabase Dashboard
2. انقر على "SQL Editor" في الشريط الجانبي
3. انقر على "New Query"
4. انسخ محتوى ملف `supabase_schema.sql` والصقه في المحرر
5. انقر على "Run" لتنفيذ السكريبت

### 5. التحقق من إنشاء الجداول

بعد تشغيل السكريبت، تحقق من إنشاء الجداول التالية:

- `games` - جدول الألعاب
- `user_scores` - جدول نقاط المستخدمين
- `user_achievements` - جدول إنجازات المستخدمين
- `user_stats` - جدول إحصائيات المستخدمين
- `game_categories` - جدول فئات الألعاب

### 6. تمكين المصادقة

1. اذهب إلى Authentication > Settings
2. تأكد من تمكين "Enable email confirmations" إذا كنت تريد تأكيد البريد الإلكتروني
3. قم بإعداد موفري المصادقة حسب الحاجة (Google, GitHub, إلخ)

## الميزات المتاحة

### الجداول الرئيسية

#### جدول الألعاب (games)
- معلومات الألعاب الأساسية
- الفئات والصعوبة
- النقاط والتقييمات
- الإنجازات المتاحة

#### جدول النقاط (user_scores)
- نقاط المستخدمين لكل لعبة
- أوقات اللعب
- تواريخ الإنجاز

#### جدول الإنجازات (user_achievements)
- إنجازات المستخدمين
- أوصاف الإنجازات
- تواريخ الحصول عليها

#### جدول الإحصائيات (user_stats)
- إحصائيات شاملة للمستخدمين
- إجمالي النقاط والألعاب
- أفضل النقاط

### الدوال المخصصة

#### `get_leaderboard(game_filter, limit_count)`
تحصل على لوحة المتصدرين مع إمكانية التصفية حسب اللعبة

#### `update_user_stats()`
تحديث إحصائيات المستخدم تلقائياً عند إضافة نقاط جديدة

### سياسات الأمان (RLS)

- المستخدمون يمكنهم قراءة جميع النقاط والإحصائيات
- المستخدمون يمكنهم تعديل بياناتهم الشخصية فقط
- حماية من التلاعب في النقاط

## استكشاف الأخطاء

### خطأ في الاتصال
- تأكد من صحة مفاتيح API في ملف `.env.local`
- تأكد من أن المشروع نشط في Supabase

### خطأ في الأذونات
- تأكد من تمكين Row Level Security
- تحقق من سياسات الأمان

### خطأ في البيانات
- تأكد من تشغيل سكريبت قاعدة البيانات بالكامل
- تحقق من وجود جميع الجداول المطلوبة

## ملاحظات مهمة

1. **النسخ الاحتياطي**: قم بعمل نسخة احتياطية من قاعدة البيانات بانتظام
2. **الأمان**: لا تشارك مفاتيح `service_role` مع أي شخص
3. **الحدود**: تحقق من حدود الاستخدام في خطة Supabase الخاصة بك
4. **التطوير**: يمكن استخدام البيانات الاحتياطية في وضع التطوير

## الدعم

إذا واجهت أي مشاكل:
1. تحقق من وثائق Supabase الرسمية
2. راجع ملفات السجل في المتصفح
3. تأكد من تحديث جميع التبعيات